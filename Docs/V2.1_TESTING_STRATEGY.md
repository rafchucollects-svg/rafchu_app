# v2.1 Testing Strategy

**Version:** v2.1 (Variants + Graded + Japanese Support)  
**Goal:** Test thoroughly before deploying to production  
**Date:** October 13, 2025

---

## üéØ **TESTING OPTIONS**

### **Option 1: Firebase Emulators (RECOMMENDED for Development)** ‚≠ê

**What it is:**
- Local Firebase services running on your machine
- Firestore, Auth, Functions, Hosting all run locally
- No cost, instant reset, fast iteration

**Pros:**
- ‚úÖ FREE - No Firebase costs during development
- ‚úÖ FAST - No network latency
- ‚úÖ ISOLATED - Doesn't touch production data
- ‚úÖ RESET - Easy to wipe and start fresh
- ‚úÖ OFFLINE - Works without internet

**Cons:**
- ‚ùå Local only - Can't share with others easily
- ‚ùå Not "real" Firebase - Some edge cases might differ
- ‚ùå Manual setup - Need to seed test data

**Best for:** Active development and quick iteration

---

### **Option 2: Separate Firebase Project (Staging Environment)** üèóÔ∏è

**What it is:**
- Create a new Firebase project (e.g., "rafchu-tcg-app-staging")
- Deploy your app to this project
- Test with real Firebase services
- Share with testers

**Pros:**
- ‚úÖ REAL Firebase - Exact production environment
- ‚úÖ SHAREABLE - Can give URL to testers
- ‚úÖ SAFE - Production data untouched
- ‚úÖ COMPLETE - All Firebase features work

**Cons:**
- ‚ùå COSTS - Real Firebase usage charges (minimal for testing)
- ‚ùå SLOWER - Network latency on every request
- ‚ùå CLEANUP - Need to manage two projects
- ‚ùå DATA - Need to populate test data

**Best for:** Final pre-production testing and user acceptance testing (UAT)

---

### **Option 3: Firebase Hosting Preview Channels** üîÄ

**What it is:**
- Deploy to a preview URL within your existing project
- Example: `https://rafchu-tcg-app--pr-v2-1-xyz.web.app`
- Uses SAME Firebase project (Firestore, Auth, etc.)
- Just different hosting URL

**Pros:**
- ‚úÖ EASY - One command to deploy preview
- ‚úÖ SHAREABLE - Get unique URL for testing
- ‚úÖ REAL DATA - Uses production Firebase (can be pro or con)
- ‚úÖ NO SETUP - No new project needed

**Cons:**
- ‚ö†Ô∏è **USES PRODUCTION DATA** - Changes affect real database!
- ‚ùå Can't test Auth separately (same user accounts)
- ‚ùå Same Firestore rules
- ‚ùå Risk of mixing test and production data

**Best for:** UI/UX testing, not for data structure changes

---

## üéØ **RECOMMENDED APPROACH FOR v2.1:**

### **Phase 1: Development (Firebase Emulators)**

Use emulators for building the features:

```bash
# Start emulators
npm run emulators

# Or manually:
firebase emulators:start
```

**Benefits:**
- Fast iteration
- Free
- No risk to production

---

### **Phase 2: Pre-Production Testing (Staging Project)**

Create a staging Firebase project for final testing:

1. **Create new Firebase project**
   - Name: `rafchu-tcg-app-staging`
   - Same configuration as production

2. **Deploy to staging**
   - Test with real Firebase
   - Invite beta testers
   - Verify everything works

3. **When ready, deploy to production**
   - Confident it works
   - Already tested with real Firebase

---

## üõ†Ô∏è **SETUP GUIDE:**

### **OPTION A: Firebase Emulators (For Development)**

#### **Step 1: Check if already configured**

```bash
# Check firebase.json for emulator config
cat firebase.json | grep -A 10 "emulators"
```

#### **Step 2: Add emulator configuration (if needed)**

Add to `firebase.json`:

```json
{
  "emulators": {
    "auth": {
      "port": 9099
    },
    "firestore": {
      "port": 8080
    },
    "hosting": {
      "port": 5000
    },
    "functions": {
      "port": 5001
    },
    "ui": {
      "enabled": true,
      "port": 4000
    }
  }
}
```

#### **Step 3: Update your app to use emulators**

Create `src/firebase-config.js` with environment detection:

```javascript
import { initializeApp } from 'firebase/app';
import { getAuth, connectAuthEmulator } from 'firebase/auth';
import { getFirestore, connectFirestoreEmulator } from 'firebase/firestore';
import { getFunctions, connectFunctionsEmulator } from 'firebase/functions';

const firebaseConfig = {
  // Your existing config
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const functions = getFunctions(app);

// Connect to emulators in development
if (import.meta.env.MODE === 'development') {
  connectAuthEmulator(auth, 'http://localhost:9099');
  connectFirestoreEmulator(db, 'localhost', 8080);
  connectFunctionsEmulator(functions, 'localhost', 5001);
  console.log('üîß Connected to Firebase Emulators');
}

export { app, auth, db, functions };
```

#### **Step 4: Start development**

```bash
# Terminal 1: Start emulators
firebase emulators:start

# Terminal 2: Start dev server
npm run dev

# Access:
# - App: http://localhost:5173 (Vite)
# - Emulator UI: http://localhost:4000
```

#### **Step 5: Seed test data**

Create a script to populate test data:

```javascript
// scripts/seed-test-data.js
import { initializeApp } from 'firebase/app';
import { getFirestore, collection, addDoc } from 'firebase/firestore';

// Add test users, cards, etc.
```

---

### **OPTION B: Staging Firebase Project**

#### **Step 1: Create new Firebase project**

1. Go to [Firebase Console](https://console.firebase.google.com/)
2. Click "Add project"
3. Name: `rafchu-tcg-app-staging`
4. Enable Google Analytics (optional)
5. Create project

#### **Step 2: Set up Firebase in the project**

```bash
# Add staging as a Firebase target
firebase use --add

# Choose your staging project
# Give it an alias: "staging"
```

This updates `.firebaserc`:

```json
{
  "projects": {
    "default": "rafchu-tcg-app",
    "staging": "rafchu-tcg-app-staging"
  }
}
```

#### **Step 3: Configure staging project**

```bash
# Switch to staging
firebase use staging

# Enable services
# - Authentication: Email/Password, Google
# - Firestore: Create database
# - Hosting: Enable
# - Functions: Enable (if using Cloud Functions)
```

#### **Step 4: Deploy Firestore rules and indexes**

```bash
# Deploy security rules
firebase deploy --only firestore:rules

# Deploy indexes
firebase deploy --only firestore:indexes
```

#### **Step 5: Build and deploy**

```bash
# Build the app
npm run build

# Deploy to staging
firebase use staging
firebase deploy
```

#### **Step 6: Access staging app**

Your app will be at:
`https://rafchu-tcg-app-staging.web.app`

#### **Step 7: Seed staging data**

Manually add test data or run a seed script against staging.

---

### **OPTION C: Preview Channels (Quick UI Testing Only)**

‚ö†Ô∏è **WARNING:** Uses production database!

```bash
# Create and deploy to preview channel
firebase hosting:channel:deploy v2-1-preview

# Access at:
# https://rafchu-tcg-app--v2-1-preview-xyz.web.app
```

**Only use this for UI/UX testing, NOT for data structure changes!**

---

## üìã **RECOMMENDED WORKFLOW FOR v2.1:**

### **Week 1-2: Development**

1. ‚úÖ Work locally with Firebase Emulators
2. ‚úÖ Build Variant support
3. ‚úÖ Build Graded card support
4. ‚úÖ Build Japanese card support
5. ‚úÖ Test thoroughly in emulators

### **Week 3: Staging**

6. ‚úÖ Create staging Firebase project
7. ‚úÖ Deploy v2.1 to staging
8. ‚úÖ Seed test data
9. ‚úÖ Invite beta testers (optional)
10. ‚úÖ Fix any issues found

### **Week 4: Production**

11. ‚úÖ Backup v2.0 (zip current version)
12. ‚úÖ Deploy v2.1 to production
13. ‚úÖ Monitor for issues
14. ‚úÖ Celebrate! üéâ

---

## üí∞ **COST CONSIDERATIONS:**

### **Emulators:**
- **FREE** - No Firebase costs
- **LOCAL** - Uses your machine resources

### **Staging Project:**
- **Firestore:** ~$0.10-1.00 for testing (small dataset)
- **Hosting:** FREE (within limits)
- **Functions:** ~$0.05-0.50 (minimal testing usage)
- **Auth:** FREE
- **Total:** <$2 for entire testing period

### **Production:**
- Existing costs continue unchanged

---

## üéØ **MY RECOMMENDATION:**

### **For v2.1 (Variants, Graded, Japanese):**

**Use Firebase Emulators for development:**
- Fast iteration
- Free
- Safe

**Create Staging Project for final testing:**
- Real Firebase environment
- Shareable with others
- Minimal cost (<$2)
- Catch any production-specific issues

**Workflow:**
1. Build in emulators (Week 1-2)
2. Deploy to staging (Week 3)
3. Test thoroughly in staging
4. Deploy to production (Week 4)

---

## üöÄ **GETTING STARTED:**

Want to use **emulators** for development?
```bash
# I'll help you set this up!
firebase emulators:start
```

Want to create a **staging project**?
```bash
# I'll walk you through this!
firebase use --add
```

Want both?
```bash
# Best of both worlds!
# Develop in emulators, test in staging, deploy to production
```

---

**Status:** üìã Ready to set up testing environment  
**Recommendation:** Emulators (dev) + Staging (testing)  
**Next Step:** User decides which approach to use










